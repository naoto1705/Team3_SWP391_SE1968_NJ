<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Customer List</title>
    <link rel="stylesheet" href="/css/CustomerStyle.css">
</head>
<body>

<div>
    <div class="header">
        <h2>Customer Management</h2>
    </div>

    <div class="content">
        <h2>Customer List</h2>

        <div class="search-sort-container">

            <!-- Ô tìm kiếm -->
            <div class="search-container">
                <form th:action="@{/customer/list}" method="get">
                    <input type="text" name="searchQuery" placeholder="Search by phone or email"
                           th:value="${param.searchQuery}"/>
                    <button type="submit">Search</button>

                    <span class="back-button"
                          th:if="${param.searchQuery != null and param.searchQuery != ''}">
                        <a th:href="@{/customer/list(page=${customerPage.number}, size=${customerPage.size}, statusFilter=${param.statusFilter})}">
                            Back
                        </a>
                    </span>

                    <input type="hidden" name="statusFilter" th:value="${param.statusFilter}"/>
                </form>
            </div>

            <!-- Bộ lọc trạng thái + nút thêm -->
            <div class="sort-add-container">
                <div class="sort-container">
                    <form th:action="@{/customer/list}" method="get">
                        <select name="statusFilter" onchange="this.form.submit()">
                            <option value="all"
                                    th:selected="${param.statusFilter == null or #strings.equalsIgnoreCase(param.statusFilter, 'all')}">
                                All
                            </option>
                            <option value="active"
                                    th:selected="${#strings.equalsIgnoreCase(param.statusFilter, 'active')}">
                                Active
                            </option>
                            <option value="inactive"
                                    th:selected="${#strings.equalsIgnoreCase(param.statusFilter, 'inactive')}">
                                Inactive
                            </option>
                        </select>
                        <input type="hidden" name="searchQuery" th:value="${param.searchQuery}"/>
                    </form>
                </div>

                <div class="add-customer">
                    <a href="/customer/add">Add Customer</a>
                </div>
            </div>
        </div>

        <!-- Bảng danh sách khách hàng -->
        <table>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>

            <tr th:each="c : ${customerPage.content}">
                <td th:text="${c.accountId}"></td>
                <td th:text="${c.firstname + ' ' + c.lastname}"></td>
                <td th:text="${c.email}"></td>
                <td th:text="${c.phoneNumber}"></td>
                <td th:text="${c.address}"></td>
                <td>
                    <span th:text="${c.enabled ? 'Active' : 'Inactive'}"
                          th:classappend="${c.enabled ? 'status-active' : 'status-inactive'}"></span>
                </td>
                <td>
                    <a th:href="@{'/customer/view/' + ${c.accountId}}" class="btn-action btn-view">View</a> |
                    <a th:href="@{'/customer/edit/' + ${c.accountId}}" class="btn-action btn-edit">Edit</a> |
                    <a th:href="@{'/customer/delete/' + ${c.accountId}}"
                       th:text="${c.enabled ? 'Deactivate' : 'Activate'}"
                       th:classappend="${c.enabled ? 'btn-toggle' : 'btn-toggle inactive'}"
                       onclick="return confirm('Are you sure to change status?')"></a>
                </td>
            </tr>
        </table>

        <!-- Phân trang -->
        <div class="pagination">
            <a th:href="@{/customer/list(page=${customerPage.number - 1}, size=${customerPage.size}, searchQuery=${param.searchQuery}, statusFilter=${param.statusFilter})}"
               th:classappend="${!customerPage.hasPrevious()} ? 'disabled' : ''">← Prev</a>

            <span th:text="${customerPage.number + 1}"></span> /
            <span th:text="${customerPage.totalPages}"></span>

            <a th:href="@{/customer/list(page=${customerPage.number + 1}, size=${customerPage.size}, searchQuery=${param.searchQuery}, statusFilter=${param.statusFilter})}"
               th:classappend="${!customerPage.hasNext()} ? 'disabled' : ''">Next →</a>
        </div>
    </div>
</div>

</body>
</html>
